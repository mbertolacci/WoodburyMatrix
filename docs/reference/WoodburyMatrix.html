<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create a Woodbury matrix identity matrix — WoodburyMatrix • WoodburyMatrix</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create a Woodbury matrix identity matrix — WoodburyMatrix"><meta property="og:description" content="Creates an implicitly defined matrix representing the equation
$$A^{-1} + U B^{-1} V,$$
where \(A, U, B\) and \(V\) are n x n, n x p, p x p and p x n matrices,
respectively. A symmetric special case is also possible with
$$A^{-1} + X B^{-1} X',$$
where \(X\) is n x p and \(A\) and \(B\) are additionally symmetric.
The available methods are described in WoodburyMatrix-class
and in solve. Multiple B / U / V / X matrices are also supported; see
below"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WoodburyMatrix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/WoodburyMatrix.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mbertolacci/WoodburyMatrix/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a Woodbury matrix identity matrix</h1>
    <small class="dont-index">Source: <a href="https://github.com/mbertolacci/WoodburyMatrix/blob/HEAD/R/WoodburyMatrix.R" class="external-link"><code>R/WoodburyMatrix.R</code></a></small>
    <div class="hidden name"><code>WoodburyMatrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates an implicitly defined matrix representing the equation
$$A^{-1} + U B^{-1} V,$$
where \(A, U, B\) and \(V\) are n x n, n x p, p x p and p x n matrices,
respectively. A symmetric special case is also possible with
$$A^{-1} + X B^{-1} X',$$
where \(X\) is n x p and \(A\) and \(B\) are additionally symmetric.
The available methods are described in <a href="WoodburyMatrix-class.html">WoodburyMatrix-class</a>
and in <a href="solve-methods.html">solve</a>. Multiple B / U / V / X matrices are also supported; see
below</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">WoodburyMatrix</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">U</span>, <span class="va">V</span>, <span class="va">X</span>, <span class="va">O</span>, <span class="va">symmetric</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>A</dt>
<dd><p>Matrix \(A\) in the definition above.</p></dd>


<dt>B</dt>
<dd><p>Matrix \(B\) in the definition above, or list of matrices.</p></dd>


<dt>U</dt>
<dd><p>Matrix \(U\) in the definition above, or list of matrices.
Defaults to a diagonal matrix/matrices.</p></dd>


<dt>V</dt>
<dd><p>Matrix \(V\) in the definition above, or list of matrices.
Defaults to a diagonal matrix/matrices.</p></dd>


<dt>X</dt>
<dd><p>Matrix \(X\) in the definition above, or list of matrices.
Defaults to a diagonal matrix/matrices.</p></dd>


<dt>O</dt>
<dd><p>Optional, precomputed value of \(O\), as defined above. THIS IS
NOT CHECKED FOR CORRECTNESS, and this argument is only provided for advanced
users who have precomputed the matrix for other purposes.</p></dd>


<dt>symmetric</dt>
<dd><p>Logical value, whether to create a symmetric or general
matrix. See Details section for more information.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code><a href="WoodburyMatrix-class.html">GWoodburyMatrix</a></code> object for a non-symmetric
matrix, <code><a href="WoodburyMatrix-class.html">SWoodburyMatrix</a></code> for a symmetric matrix.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The benefit of using an implicit representation is that the inverse
of this matrix can be efficiently calculated via
$$A - A U O^{-1} V A$$
where \(O = B + VAU\), and its determinant by
$$det(O) det(A)^{-1} det(B)^{-1}.$$
These relationships are often called the Woodbury matrix identity and the
matrix determinant lemma, respectively. If \(A\) and \(B\) are sparse or
otherwise easy to deal with, and/or when \(p &lt; n\), manipulating the
matrices via these relationships rather than forming \(W\) directly can
have huge advantageous because it avoids having to create the (typically
dense) matrix $$A^{-1} + U B^{-1} V$$ directly.</p>
    </div>
    <div id="symmetric-form">
    <h2>Symmetric form</h2>
    

<p>Where applicable, it's worth using the symmetric form of the matrix. This
takes advantage of the symmetry where possible to speed up operations, takes
less memory, and sometimes has numerical benefits. This function will create
the symmetric form in the following circumstances:</p><ul><li><p><code>symmetry = TRUE</code>; or</p></li>
<li><p>the argument <code>X</code> is provided; or</p></li>
<li><p><code>A</code> and <code>B</code> are symmetric (according to
  <code><a href="https://rdrr.io/r/base/isSymmetric.html" class="external-link">isSymmetric</a></code>) and the arguments <code>U</code> and <code>V</code> are
  NOT provided.</p></li>
</ul></div>
    <div id="multiple-b-matrices">
    <h2>Multiple B matrices</h2>
    

<p>A more general form allows for multiple B matrices:
$$A^{-1} + \sum_{i = 1}^n U_i B_i^{-1} V_i,$$
and analogously for the symmetric form. You can use this form by providing
a list of matrices as the <code>B</code> (or <code>U</code>, <code>V</code> or <code>X</code>)
arguments. Internally, this is implemented by converting to the standard form
by letting <code>B = bdiag(...the B matrices...)</code>,
<code>U = cbind(..the U matrices...)</code>, and so on.</p>
<p>The <code>B</code>, <code>U</code>, <code>V</code> and <code>X</code> values are recycled to the
length of the longest list, so you can, for instance, provide multiple B
matrices but only one U matrix (and vice-versa).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>More information on the underlying linear algebra can be found
in Harville, D. A. (1997) &lt;doi:10.1007/b98818&gt;.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="WoodburyMatrix-class.html">WoodburyMatrix</a>, <a href="solve-methods.html">solve</a>, <a href="instantiate.html">instantiate</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org/" class="external-link">Matrix</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Example solving a linear system with general matrices</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">WoodburyMatrix</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formal class 'dgeMatrix' [package "Matrix"] with 4 slots</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dim     : int [1:2] 100 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dimnames:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ x       : num [1:100] 0.0691 1.1257 0.9255 1.78 0.3812 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ factors : list()</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculating the determinant of a symmetric system</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">0.5</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">WoodburyMatrix</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/det.html" class="external-link">determinant</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $modulus</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.518412</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"logarithm")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sign</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "det"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Having a lower rank B matrix and an X matrix</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">WoodburyMatrix</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formal class 'dgeMatrix' [package "Matrix"] with 4 slots</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dim     : int [1:2] 100 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dimnames:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ x       : num [1:100] 0.414 1.254 1.97 -1.808 -0.687 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ factors : list()</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple B matrices</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">B2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/rsparsematrix.html" class="external-link">rsparsematrix</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">WoodburyMatrix</span><span class="op">(</span><span class="va">A</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">B1</span>, <span class="va">B2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formal class 'dgeMatrix' [package "Matrix"] with 4 slots</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dim     : int [1:2] 100 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ Dimnames:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ : NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ x       : num [1:100] -1.405 -0.773 -1.682 1.7 4.926 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..@ factors : list()</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael Bertolacci.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

